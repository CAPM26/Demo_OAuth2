<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>OAuth2 Authorization Code + PKCE (Demo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; margin: 40px; max-width: 820px; line-height: 1.5 }
    nav { margin-bottom: 20px; padding: 10px; background: #f2f2f2; border-radius: 6px }
    nav a { margin-right: 10px; text-decoration: none; }
    button { padding: 6px 14px; margin: 5px; }
    pre { background: #fafafa; border: 1px solid #ddd; padding: 10px; border-radius: 6px; overflow-x: auto }
    h1, h2 { color: #333 }
    .card { border: 1px solid #ddd; padding: 16px; border-radius: 6px; margin: 20px 0 }
  </style>
</head>
<body>
  <nav>
    <a href="/">🏠 Inicio</a>
    <a href="/login">🔐 Iniciar sesión</a>
    <a href="/profile">👤 Perfil</a>
    <a href="/orders">📦 Órdenes</a>
    <a href="/logout">🚪 Cerrar sesión</a>
  </nav>

  <h1>Demo OAuth 2.0 con Auth0</h1>
  <p>Esta aplicación demuestra el flujo <b>Authorization Code + PKCE</b> usando <b>Auth0</b> y una <b>API ASP.NET protegida</b>.</p>

  <div class="card">
    <h2>Flujo que se demuestra</h2>
    <ol>
      <li><b>Autenticación</b>: Login → el usuario se autentica en Auth0.</li>
      <li><b>Autorización</b>: Se obtiene un <code>access_token</code> con <i>scopes</i>.</li>
      <li><b>JWT</b>: El token se usa contra la API; puedes verlo decodificado y enviarlo a <a href="https://jwt.io" target="_blank">jwt.io</a>.</li>
      <li><b>API</b>: La app llama a la API protegida (<code>/orders</code>) con Bearer token.</li>
    </ol>
  </div>

  <div class="card">
    <h2>Prueba rápida</h2>
    <p>
      <a href="/login"><button>🔐 Iniciar sesión</button></a>
      <a href="/logout"><button>🚪 Cerrar sesión</button></a>
    </p>

    <h3>Perfil (userinfo)</h3>
    <pre id="profileOut">(sin datos)</pre>
    <p><button id="btnProfile">➡️ Llamar a /profile</button></p>

    <h3>Órdenes (API)</h3>
    <pre id="ordersOut">(sin datos)</pre>
    <p><button id="btnOrders">➡️ Llamar a /orders</button></p>
  </div>

  <script>
    document.getElementById('btnProfile').onclick = async () => {
      const res = await fetch('/profile');
      const text = await res.text();
      document.getElementById('profileOut').textContent = text;
    };

    document.getElementById('btnOrders').onclick = async () => {
      const res = await fetch('/orders');
      const text = await res.text();
      document.getElementById('ordersOut').textContent = text;
    };
  </script>
</body>
</html>
